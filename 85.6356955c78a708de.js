"use strict";(self.webpackChunkApp=self.webpackChunkApp||[]).push([[85],{6085:(nt,h,r)=>{r.r(h),r.d(h,{FightPageModule:()=>tt});var a=r(9808),l=r(4444),C=r(7579),w=r(9646),b=r(727);class O extends b.w0{constructor(i,e){super()}schedule(i,e=0){return this}}const d={setInterval(n,i,...e){const{delegate:o}=d;return(null==o?void 0:o.setInterval)?o.setInterval(n,i,...e):setInterval(n,i,...e)},clearInterval(n){const{delegate:i}=d;return((null==i?void 0:i.clearInterval)||clearInterval)(n)},delegate:void 0};var M=r(8737);const p={now:()=>(p.delegate||Date).now(),delegate:void 0};class u{constructor(i,e=u.now){this.schedulerActionCtor=i,this.now=e}schedule(i,e=0,o){return new this.schedulerActionCtor(this,i).schedule(o,e)}}u.now=p.now;const g=new class A extends u{constructor(i,e=u.now){super(i,e),this.actions=[],this._active=!1,this._scheduled=void 0}flush(i){const{actions:e}=this;if(this._active)return void e.push(i);let o;this._active=!0;do{if(o=i.execute(i.state,i.delay))break}while(i=e.shift());if(this._active=!1,o){for(;i=e.shift();)i.unsubscribe();throw o}}}(class F extends O{constructor(i,e){super(i,e),this.scheduler=i,this.work=e,this.pending=!1}schedule(i,e=0){if(this.closed)return this;this.state=i;const o=this.id,s=this.scheduler;return null!=o&&(this.id=this.recycleAsyncId(s,o,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(s,this.id,e),this}requestAsyncId(i,e,o=0){return d.setInterval(i.flush.bind(i,this),o)}recycleAsyncId(i,e,o=0){if(null!=o&&this.delay===o&&!1===this.pending)return e;d.clearInterval(e)}execute(i,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const o=this._execute(i,e);if(o)return o;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(i,e){let s,o=!1;try{this.work(i)}catch(c){o=!0,s=c||new Error("Scheduled action threw falsy error")}if(o)return this.unsubscribe(),s}unsubscribe(){if(!this.closed){const{id:i,scheduler:e}=this,{actions:o}=e;this.work=this.state=this.scheduler=null,this.pending=!1,(0,M.P)(o,this),null!=i&&(this.id=this.recycleAsyncId(e,i,null)),this.delay=null,super.unsubscribe()}}}),_=g;var Z=r(7272),f=r(5698),H=r(4482),S=r(5403),I=r(5032),U=r(4004),j=r(5577);function m(n,i){return i?e=>(0,Z.z)(i.pipe((0,f.q)(1),function T(){return(0,H.e)((n,i)=>{n.subscribe((0,S.x)(i,I.Z))})}()),e.pipe(m(n))):(0,j.z)((e,o)=>n(e,o).pipe((0,f.q)(1),function N(n){return(0,U.U)(()=>n)}(e)))}var L=r(8306),k=r(3532);var E=r(2722),t=r(1223),v=r(7594),Q=r(2881);let q=(()=>{class n{constructor(e){this.storeService=e}letsFight(e,o){const s=this.calcStats(e.powerstats),c=this.calcStats(o.powerstats);return s>c?(this.storeService.patchUserState(l.PP.BattleHistory,{winner:"Win",date:new Date,myHero:e.name,enemyHero:o.name,myHeroId:e.id,enemyHeroId:o.id}),e.name):s<c?(this.storeService.patchUserState(l.PP.BattleHistory,{winner:"Loose",date:new Date,myHero:e.name,enemyHero:o.name,myHeroId:e.id,enemyHeroId:o.id}),o.name):(alert("Ooops, this fight doesn`t make sense!"),"")}calcStats(e){const o=Object.values(e).filter(s=>"null"!==s).map(s=>Number(s));return 0!==o.length||(o[0]=0),o.reduce((s,c)=>s+c,0)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(v.d))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var x=r(7363);let y=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-loading"]],decls:1,vars:0,consts:[[1,"spinner"]],template:function(e,o){1&e&&t._UZ(0,"div",0)},styles:['.spinner[_ngcontent-%COMP%]{color:#fff;display:flex;align-items:center;justify-content:center}.spinner[_ngcontent-%COMP%]:after{animation:changeContent .8s linear infinite;display:block;content:"\\280b";font-size:80px;color:#000}@keyframes changeContent{10%{content:"\\2819"}20%{content:"\\2839"}30%{content:"\\2838"}40%{content:"\\283c"}50%{content:"\\2834"}60%{content:"\\2826"}70%{content:"\\2827"}80%{content:"\\2807"}90%{content:"\\280f"}}']}),n})();function $(n,i){if(1&n&&(t.ynx(0),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.BQk()),2&n){const e=i.$implicit;t.xp6(2),t.AsE(" ",e.key,": ",e.value," ")}}function z(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const s=t.oxw().$implicit;return t.oxw(2).addPowerups(s.statName)}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.xp6(1),t.AsE("",e.name,", ",e.stats,"")}}function D(n,i){if(1&n&&(t.TgZ(0,"div"),t.YNc(1,z,2,2,"button",17),t.qZA()),2&n){const e=i.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",o.isPowerupActiveInCurrentFight[e.statName]&&e.usesLeft)}}function G(n,i){1&n&&t._UZ(0,"app-loading")}function R(n,i){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.AsE(" ",e.key,": ",e.value," ")}}function V(n,i){if(1&n&&(t.ynx(0),t.YNc(1,R,2,2,"span",14),t.BQk()),2&n){const e=i.$implicit;t.xp6(1),t.Q6J("ngIf","null"!==e.value)}}const K=function(n){return{visibility:n}};function W(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3),t._uU(3),t.qZA(),t.TgZ(4,"div",4),t._uU(5),t.qZA(),t.TgZ(6,"div",5),t._UZ(7,"img",6),t.qZA(),t.TgZ(8,"div",7),t.YNc(9,$,3,2,"ng-container",8),t.ALo(10,"keyvalue"),t.qZA()(),t.TgZ(11,"div",9)(12,"div",10)(13,"div",11),t._uU(14),t.qZA(),t.TgZ(15,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().fight()}),t._uU(16,"FIGHT!"),t.qZA(),t.TgZ(17,"div",11),t._uU(18),t.qZA()(),t.TgZ(19,"div",13)(20,"h3"),t._uU(21,"PowerUps"),t.qZA(),t.YNc(22,D,2,1,"div",8),t.qZA(),t.YNc(23,G,1,0,"app-loading",14),t.qZA(),t.TgZ(24,"div",2)(25,"div",3),t._uU(26),t.qZA(),t.TgZ(27,"div",4),t._uU(28),t.qZA(),t.TgZ(29,"div",5),t._UZ(30,"img",6),t.qZA(),t.TgZ(31,"div",7),t.YNc(32,V,2,1,"ng-container",8),t.ALo(33,"keyvalue"),t.qZA()(),t.TgZ(34,"div",15)(35,"div",1)(36,"div",16),t._uU(37),t.qZA(),t.TgZ(38,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().isBattleOver=!1}),t._uU(39,"Close"),t.qZA()()()()}if(2&n){const e=t.oxw();t.xp6(2),t.MGl("routerLink","/hero-info/",e.myHero.id,""),t.xp6(1),t.Oqu(e.myHero.name),t.xp6(2),t.Oqu(e.myHero.biography["full-name"]),t.xp6(2),t.s9C("src",e.myHero.image.url,t.LSH),t.xp6(2),t.Q6J("ngForOf",t.lcZ(10,16,e.myheroPowerstats)),t.xp6(5),t.Oqu(e.myHero.name),t.xp6(4),t.Oqu(e.enemyHero.name),t.xp6(4),t.Q6J("ngForOf",e.powerups),t.xp6(1),t.Q6J("ngIf",e.isFightNow),t.xp6(2),t.MGl("routerLink","/hero/",e.enemyHero.id,""),t.xp6(1),t.Oqu(e.enemyHero.name),t.xp6(2),t.Oqu(e.enemyHero.biography["full-name"]),t.xp6(2),t.s9C("src",e.enemyHero.image.url,t.LSH),t.xp6(2),t.Q6J("ngForOf",t.lcZ(33,18,e.enemyHero.powerstats)),t.xp6(2),t.Q6J("ngClass",t.VKq(20,K,e.isBattleOver)),t.xp6(3),t.hij("",e.winner," win this fight")}}let P=(()=>{class n{constructor(e,o,s){this.storeService=e,this.fetchService=o,this.battleService=s,this.isFightNow=!1,this.myheroPowerstats={},this.isPowerupActiveInCurrentFight={},this.isBattleOver=!1,this.winner="",this.unsubscribeOnDestroy$=new C.x}ngOnInit(){this.getMyHero(),this.getEnemyHero(),this.powerups=this.storeService.userState[l.PP.Powerups],this.myheroPowerstats=Object.assign({},this.myHero.powerstats),this.setPowerupsStatusInCurrentFight()}fight(){this.isFightNow=!0,(0,w.of)("").pipe(function Y(n,i=g){const e=function J(n=0,i,e=_){let o=-1;return null!=i&&((0,k.K)(i)?e=i:o=i),new L.y(s=>{let c=function B(n){return n instanceof Date&&!isNaN(n)}(n)?+n-e.now():n;c<0&&(c=0);let et=0;return e.schedule(function(){s.closed||(s.next(et++),0<=o?this.schedule(void 0,o):s.complete())},c)})}(n,i);return m(()=>e)}(5e3),(0,E.R)(this.unsubscribeOnDestroy$)).subscribe(()=>{this.winner=this.battleService.letsFight(this.myHero,this.enemyHero),this.isFightNow=!1,this.myheroPowerstats=Object.assign({},this.myHero.powerstats),this.isBattleOver=!0})}addPowerups(e){const o=this.powerups.find(s=>s.statName===e);this.myheroPowerstats[e]=(Number(this.myHero.powerstats[e])+10).toString(),o.usesLeft=o.usesLeft-1,this.isPowerupActiveInCurrentFight[e]=!1,this.storeService.changeUserState(l.PP.Powerups,[...this.powerups])}setPowerupsStatusInCurrentFight(){this.isPowerupActiveInCurrentFight=this.powerups.reduce((e,o)=>Object.assign(Object.assign({},e),{[o.statName]:!0}),{})}getMyHero(){this.myHero=this.storeService.userState[l.PP.SelectedHero]}getEnemyHero(){this.enemyHeroSub=this.fetchService.getRandomHero().subscribe(e=>{this.enemyHero=e})}ngOnDestroy(){this.enemyHeroSub.unsubscribe(),this.unsubscribeOnDestroy$.next(!0)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(v.d),t.Y36(Q.r),t.Y36(q))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-fight-page"]],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"hero"],[1,"name",3,"routerLink"],[1,"full-name"],[1,"avatar"],[3,"src"],[1,"stats"],[4,"ngFor","ngForOf"],[1,"optional"],[1,"names"],[1,"name"],[3,"click"],[1,"powerups"],[4,"ngIf"],[1,"modal",3,"ngClass"],[1,"message"],[3,"click",4,"ngIf"]],template:function(e,o){1&e&&t.YNc(0,W,40,22,"div",0),2&e&&t.Q6J("ngIf",o.enemyHero)},directives:[a.O5,x.rH,a.sg,y,a.mk],pipes:[a.Nd],styles:[".container[_ngcontent-%COMP%]{border:3px solid #82589F;font-size:20px;display:flex;justify-content:center;position:absolute;margin-left:10vw;margin-right:10vw;left:0;right:0;top:0}.hero[_ngcontent-%COMP%]{width:30vw;display:flex;flex-direction:column;justify-content:center;align-items:center;margin:20px 0}.hero[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border:3px solid #82589F;width:300px;height:500px;margin:20px 0}.stats[_ngcontent-%COMP%], .powerups[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:3px solid #82589F;width:300px;height:205px}.stats[_ngcontent-%COMP%]   span[_ngcontent-%COMP%], .powerups[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{padding:5px 0 5px 10px}.optional[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.optional[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]{height:200px;width:300px;display:flex;flex-direction:column;justify-content:center;align-items:center;border:3px solid #82589F;margin-bottom:20px}.optional[_ngcontent-%COMP%]   .names[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:10px 0;width:306px;border-bottom:3px solid #82589F;border-top:3px solid #82589F;display:flex;align-items:center;justify-content:center}.optional[_ngcontent-%COMP%]   .powerups[_ngcontent-%COMP%]{height:50%;display:flex;flex-direction:column;justify-content:center;align-items:center}.optional[_ngcontent-%COMP%]   .powerups[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.optional[_ngcontent-%COMP%]   .powerups[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#2980b9}button[_ngcontent-%COMP%]{transition-duration:.4s;border:1px solid #0000001f;cursor:pointer;padding:0 15px;margin:5px;box-shadow:2px 2px 2px 2px #888;height:40px;border-radius:15px;width:100px}button[_ngcontent-%COMP%]:hover{background-color:red}.modal[_ngcontent-%COMP%]{position:absolute;margin-left:auto;margin-right:auto;left:0;right:0;top:0;width:100%;height:100%;background-color:#474757b3;transition:1s;visibility:hidden;opacity:0}.modal[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;border:none}.modal.visibility[_ngcontent-%COMP%]{visibility:visible;opacity:1}.modal[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{height:10%;width:50%;border:2px solid #2980b9;border-radius:5px;background-color:#fff}.modal[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:20px}.modal[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#6c7a89}"]}),n})();var X=r(1837);let tt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[a.ez,x.Bz.forChild([{path:"",component:P,canActivate:[X.A]}])]]}),n})()}}]);